<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Equipos a Reparar</title>
</head>
<body>
  <table border="1" cellspacing="0" cellpadding="5">
    <thead>
      <tr>
        <th>Equipo</th>
        <th>Reparación</th>
        <th>Precio</th>
        <th>Observaciones</th>
      </tr>
    </thead>
    <tbody id="equipmentsTable">
    </tbody>
  </table>

  <script>
    // Obtener parámetros de la URL
    const urlParams = new URLSearchParams(window.location.search);
    const equipmentsParam = urlParams.get("equipments");

    if (equipmentsParam) {
      try {
        const equipments = JSON.parse(decodeURIComponent(equipmentsParam));
        const tbody = document.getElementById("equipmentsTable");

        equipments.forEach(equipment => {
          if (equipment.repairs && equipment.repairs.length > 0) {
            equipment.repairs.forEach((repair, index) => {
              const tr = document.createElement("tr");

              // Columna equipo (solo en la primera reparación)
              const tdDevice = document.createElement("td");
              if (index === 0) {
                tdDevice.textContent = equipment.device || "";
                tdDevice.rowSpan = equipment.repairs.length;
              }

              // Columna reparación
              const tdRepair = document.createElement("td");
              tdRepair.textContent = repair.repairDetail || "";

              // Columna precio
              const tdPrice = document.createElement("td");
              tdPrice.textContent = repair.price != null ? repair.price : "";

              // Columna observaciones (solo en la primera reparación)
              const tdObs = document.createElement("td");
              if (index === 0) {
                tdObs.textContent = equipment.observations || "";
                tdObs.rowSpan = equipment.repairs.length;
              }

              if (index === 0) tr.appendChild(tdDevice);
              tr.appendChild(tdRepair);
              tr.appendChild(tdPrice);
              if (index === 0) tr.appendChild(tdObs);

              tbody.appendChild(tr);
            });
          }
        });
      } catch (e) {
        console.error("Error procesando los datos:", e);
      }
    }
  </script>
</body>
</html>
