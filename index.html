<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Equipos</title>
  <style>
    table {
      width: 100%;
      border-collapse: collapse;
      border: 1px solid black;
    }
    th, td {
      border: 1px solid black;
      padding: 5px;
      text-align: center;
      vertical-align: middle;
    }
    .no-border {
      border-top: none;
      border-bottom: none;
    }
  </style>
</head>
<body>
  <table>
    <thead>
      <tr>
        <th>Equipo</th>
        <th>Reparación</th>
        <th>Precio</th>
        <th>Observaciones</th>
      </tr>
    </thead>
    <tbody id="equipments-table">
    </tbody>
  </table>

  <script>
    // Obtener parámetros de la URL
    const params = new URLSearchParams(window.location.search);
    const equipmentsData = params.get("equipments");

    if (equipmentsData) {
      try {
        const equipments = JSON.parse(decodeURIComponent(equipmentsData));
        const tbody = document.getElementById("equipments-table");

        equipments.forEach(eq => {
          const repairs = eq.repairs || [];
          const rowSpan = repairs.length || 1;

          repairs.forEach((rep, index) => {
            const tr = document.createElement("tr");

            if (index === 0) {
              // Celda de Equipo (centrada verticalmente)
              const tdEquipo = document.createElement("td");
              tdEquipo.textContent = eq.device || "";
              tdEquipo.rowSpan = rowSpan;
              tr.appendChild(tdEquipo);
            }

            // Reparación
            const tdRepair = document.createElement("td");
            tdRepair.textContent = rep.repairDetail || "";
            tr.appendChild(tdRepair);

            // Precio
            const tdPrice = document.createElement("td");
            tdPrice.textContent = rep.price || "";
            tr.appendChild(tdPrice);

            if (index === 0) {
              // Observaciones (una sola vez)
              const tdObs = document.createElement("td");
              tdObs.textContent = eq.observations || "";
              tdObs.rowSpan = rowSpan;
              tr.appendChild(tdObs);
            }

            tbody.appendChild(tr);
          });

          if (repairs.length === 0) {
            const tr = document.createElement("tr");
            const tdEquipo = document.createElement("td");
            tdEquipo.textContent = eq.device || "";
            tr.appendChild(tdEquipo);

            tr.appendChild(document.createElement("td"));
            tr.appendChild(document.createElement("td"));

            const tdObs = document.createElement("td");
            tdObs.textContent = eq.observations || "";
            tr.appendChild(tdObs);

            tbody.appendChild(tr);
          }
        });
      } catch (error) {
        console.error("Error al parsear los datos de equipos:", error);
      }
    }
  </script>
</body>
</html>
