<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Recibo</title>
  <style>
    table {
      width: 100%;
      border-collapse: collapse;
      font-family: Arial, sans-serif;
      font-size: 12px;
    }
    th, td {
      border: 1px solid black;
      padding: 4px;
      text-align: left;
      vertical-align: top;
    }
  </style>
</head>
<body>

<h2>Equipos y Reparaciones</h2>
<table>
  <thead>
    <tr>
      <th>Equipo</th>
      <th>Reparación</th>
      <th>Precio</th>
      <th>Observaciones</th>
    </tr>
  </thead>
  <tbody id="equipmentsTable"></tbody>
</table>

<script>
  // Obtener parámetros desde la URL
  const urlParams = new URLSearchParams(window.location.search);
  const equipmentsData = urlParams.get("equipments");

  if (equipmentsData) {
    try {
      const equipments = JSON.parse(decodeURIComponent(equipmentsData));
      const tableBody = document.getElementById("equipmentsTable");

      equipments.forEach(eq => {
        const repairCount = eq.repairs.length || 1;
        const rowEquipo = document.createElement("tr");

        // Columna de equipo (una sola celda para todo el grupo)
        const tdEquipo = document.createElement("td");
        tdEquipo.textContent = eq.device || "";
        tdEquipo.rowSpan = repairCount;
        rowEquipo.appendChild(tdEquipo);

        // Primera reparación
        if (eq.repairs.length > 0) {
          const firstRepair = eq.repairs[0];
          const tdRepair = document.createElement("td");
          tdRepair.textContent = firstRepair.repairDetail || "";
          rowEquipo.appendChild(tdRepair);

          const tdPrice = document.createElement("td");
          tdPrice.textContent = firstRepair.price || "";
          rowEquipo.appendChild(tdPrice);
        } else {
          const tdEmptyRepair = document.createElement("td");
          tdEmptyRepair.textContent = "";
          rowEquipo.appendChild(tdEmptyRepair);

          const tdEmptyPrice = document.createElement("td");
          tdEmptyPrice.textContent = "";
          rowEquipo.appendChild(tdEmptyPrice);
        }

        // Columna Observaciones (una sola celda para todo el grupo)
        const tdObs = document.createElement("td");
        tdObs.textContent = eq.observations || "";
        tdObs.rowSpan = repairCount;
        rowEquipo.appendChild(tdObs);

        tableBody.appendChild(rowEquipo);

        // Resto de reparaciones
        for (let i = 1; i < eq.repairs.length; i++) {
          const r = eq.repairs[i];
          const rowRepair = document.createElement("tr");

          const tdRepair = document.createElement("td");
          tdRepair.textContent = r.repairDetail || "";
          rowRepair.appendChild(tdRepair);

          const tdPrice = document.createElement("td");
          tdPrice.textContent = r.price || "";
          rowRepair.appendChild(tdPrice);

          tableBody.appendChild(rowRepair);
        }
      });
    } catch (err) {
      console.error("Error al procesar los datos:", err);
    }
  }
</script>

</body>
</html>
